<html>

	<head>
		<title>Protocol Generator</title>
		<script type='text/javascript' src='knockout-2.1.0.js'></script>


	</head>

	<body>

		Protocol Generator

		<div>

			<input type="textfield" data-bind="value: modelName"></input>
			<br/>
			<textarea rows="20" cols="50" data-bind="value: json"></textarea>
			<br/>
			<input type="button" value="Generate" data-bind="click: generate"></input>
		</div>

		<div style="margin: 10px; padding: 10px; background-color: #EAEAEA;">

			<div>
				#import "<span data-bind="text: modelName">&nbsp;</span>.h"
			</div>

			<br/>

			<div>
				@interface <span data-bind="text: modelName">&nbsp;</span> : ProtocolObject
			</div>

			<br/>

			<!-- ko foreach: jsonObject -->

			<div data-bind="text: property()"></div>

			<!-- /ko -->

			<br/>

			<div>
				@end
			</div>

		</div>

		<div style="margin: 10px; padding: 10px; background-color: #EAEAEA;">

			<div>
				#import "<span data-bind="text: modelName">&nbsp;</span>.h"
			</div>

			<br/>

			<div>
				@implementation <span data-bind="text: modelName">&nbsp;</span>
			</div>

			<br/>

			<!-- ko foreach: jsonObject -->

			<div data-bind="text: synthesize()"></div>

			<!-- /ko -->

			<br/>

			- (NSDictionary *)mapKeysToProperties {
			<br/>
			return [[NSDictionary alloc] initWithObjectsAndKeys:
			<br/>

			<!-- ko foreach: jsonObject -->
			<div data-bind="text: mapKeysToProperties()"></div>
			<!-- /ko -->

			<br/>
			nil];
			<br/>
			}
			<br/>

			<div>
				@end
			</div>

		</div>


	</body>

	<script type="text/javascript">

		(function() {

		 	String.prototype.toProperCase = function () {
				return this.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
			};

			String.prototype.toCamel = function () {
				var camel = this.replace(/(\_[a-z])/g, function($1){return $1.toUpperCase().replace('_','');});
				camel = camel.replace(/(\-[a-z])/g, function($1){return $1.toUpperCase().replace('-','');});
				camel = camel.replace(/(\ [a-z])/g, function($1){return $1.toUpperCase().replace(' ','');});

				camel = camel.charAt(0).toLowerCase() + camel.slice(1);

				return camel;
			};

			function Attribute(name, value) {

				this.name = name;
				this.value = value;

				this.varName = function() {
					return this.name.toCamel();
				};

				this.property = function() {

					var varName = this.varName();

					if (typeof(value) == "string") {
						return "@property (nonatomic, strong) NSString *" + varName + ";";	
					} else if (typeof(value) == "number") {
						return "@property (nonatomic, strong) NSNumber *" + varName + ";";	
					} else if (typeof(value) == "boolean") {
						return "@property (nonatomic, assign) BOOL " + varName + ";";	
					}

				};

				this.synthesize = function() {

					var varName = this.varName();

					return "@synthesize " + varName + " = _" + varName + ";"; 

				};

				this.mapKeysToProperties = function() {
					return "@\"" + this.varName()  + "\",@\"" + this.name  + "\",";
				}

			}

			function ViewModel() {

				this.modelName = ko.observable("ModelName");

				this.json = ko.observable('{"some_string":"Test string", "number":5,"bool_value":true}');
				this.jsonObject = ko.observableArray();

				this.generate = function() {
					var jsonEvaled = eval('(' + this.json() + ')');
					if (jsonEvaled == null) {
						return null;
					}

					var attributes = [];
					for (var key in jsonEvaled) {
						var attribute = new Attribute(key, jsonEvaled[key]);
						attributes.push(attribute);
					}

					this.jsonObject(attributes);
				};

				this.generate();

			}

			// Activates knockout.js
			var viewModel = new ViewModel();
			ko.applyBindings(viewModel);

			viewModel.generate();
		})();

	</script>

</html>
